<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="width=device-width,initial-scale=1.0" name="viewport">
    <title>Adam Quinton | Zvakanaka</title>
    <base href="https://zvakanaka.github.io">
    <script src="mere-blog/dist/js/marked.min.js"></script>
    <script src="mere-blog/dist/js/main.js"></script>
    <link rel="stylesheet" href="mere-blog/dist/css/main.css">
    <link rel="stylesheet" href="mere-blog/dist/css/markdown.css">
  </head>
  <body>
    <aside class="navigation"></aside>
    <main class="main">
      <article class="markdown-body"></article>
    </main>
    <script>
      // custom replace aside titles function to load posts from another repo (see special setup in posts.json)
      function getPostName(el) {
        const postNameRegexArr = el.textContent.match(/(^.*)\/([\w-.:]+)/);
        if (postNameRegexArr) {
          const [ , path, postName ] = postNameRegexArr;
          return postName;
        }
      }
      document.addEventListener('postLoaded', function replaceAsideTitles(ev) {
        document.querySelectorAll('.navigation ul > li').forEach(li => {
          const postName = getPostName(li);
          if (postName) {
            if (li.children.length === 0) {
              li.textContent = postName;
            } else if (li.childNodes && li.childNodes.length > 1 && li.childNodes[0].nodeType === 3) {
              li.childNodes[0].textContent = getPostName(li.childNodes[0]);
            }
          }
        });
      });
    </script>
    <script>
    function forceNoCacheHash(src, useCache = true) {
      if (useCache) return src; // fine with using cached assets
      const delim = src.indexOf('?') > -1 ? '&' : '?';
      return `${src}${delim}${Math.random().toString(36).substring(7)}`;
    }
    function addScript(src, useCache) {
      const s = document.createElement('script');
      s.setAttribute('src', forceNoCacheHash(src, useCache));
      document.body.appendChild(s);
    }
    function addCss(url, useCache) {
      const element = document.createElement('link');
      element.setAttribute('rel', 'stylesheet');
      element.setAttribute('type', 'text/css');
      element.setAttribute('href', forceNoCacheHash(url, useCache));
      document.getElementsByTagName('head')[0].appendChild(element);
    }
    function getHtml(url, useCache) {
      return new Promise((resolve, reject) => {
        fetch(forceNoCacheHash(url, useCache))
          .then(res => res.text())
          .then(body => {
            resolve(body);
          });
      });
    }
    function addHtml(str) {
      const div = document.createElement('div');
      div.style.display = 'contents';
      div.innerHTML = str;
      document.body.appendChild(div);
    }
    function addCssStr(str) {
      const styleEl = document.createElement('style');
      styleEl.innerHTML = str;
      document.head.appendChild(styleEl);
    }

    function addPen(pen) {
      const base = '.';
      getHtml(`${base}/cpio/${pen}/${pen}.html`).then(htmlStr => {
        addHtml(htmlStr);
        addCss(`${base}/cpio/${pen}/${pen}.css`);
        addScript(`${base}/cpio/${pen}/${pen}.js`);
      });
    }

    let easterEggLoaded = false;
    document.addEventListener('postLoaded', function() {
      const easterEggLink = document.querySelector('.markdown-body #github + p a');
      if (easterEggLink) {
        easterEggLink.addEventListener('mouseover', function() {
          if (!easterEggLoaded) {
            addPen('YbOoRE');
            addCssStr(`
              body { color: white !important; }
              main { z-index: 1; }
              aside > ul { z-index: 1; }
              .markdown-body { background: #fffa; }
            `);
          }
          easterEggLoaded = true;
        })
      }
    });
    </script>
    <script src="mere-blog/dist/js/plugin-scroll-state.js"></script>
    <script src="mere-blog/dist/js/plugin-html5-video.js"></script>
    <script src="mere-blog/dist/js/plugin-code-highlight.js"></script>
  </body>
</html>
